책에 없는데 강의에는 있는 내용.

# Process Synchronization(프로세스 동기화)

- 프로세스들의 일반적인 구조

```
do {
  entry section
  critical section
  exit section
  remainder section
} while (1)
```

- 프로세스들은 수행의 동기화(synchronize)를 위해 몇몇 변수를 공유할 수 있다 => synchronization variable

- 프로그램적 해결법의 충족 조건

  - Mutual Exclusion: 프로세스 Pi가 critical section 부분을 수행중이면 다른 모든 프로세스들은 그들의 critical section에 들어가면 안 된다.
  - Progress: 아무도 critical section에 있지 않은 상태에서 critical section에 들어가고자 하는 프로세스가 있으면 critical section에 들어가게 해주어야 한다.
  - Bounded Waiting: 프로세스가 critical section에 들어가려고 요청한후부터 그 요청이 허용될 때까지 다른 프로세스들이 critical section에 들어가는 횟수에 한계가 있어야 한다.

- 다양한 알고리즘으로 이를 해결
  - ex) Peterson's Algorithm. flag와 turn 두 개를 이용해 해결. 단, cpu와 memory를 계속 사용하는 Busy Waiting(spin lock)

```
do {
  flag[i] = true;
  turn = j;
  while(flag[j] && turn==j); // wait only if...
  critical section
  flag[i] = false;
  remainder section
}
```

- 이를 하드웨어적으로 Test & modify를 atomic하게 지원하기도 한다.

```
Synchronization variable:
  boolean lock = false;

Process Pi
  do{
    while(Test_and_Set(lock));
    critical section
    lock = false;
    remainder section
  }
```

- 더 나아가면 Semaphore를 이용해 앞의 방식을 추상화시킨다.
- Semaphore S는 int variable(자원 개수)
- P와 V 연산에 의해서만 접근 가능
  - P(S): 공유데이터 획득. 락을 건다. 자원을 한개씩 가져간다.(5=>4)
  ```
  while(S<=0) do no-op;
  S--;
  ```
  - V(S): 다 사용하고 반납하는 과정. 락을 푼다. 자원을 되돌린다.(4=>5)
  ```
  S++;
  ```
- busy wait가 아니라 Block & WakeUp(sleep lock) 방식으로 구현 가능.
  P(S)

  ```
  S.value--;
  if(S.value<0)
  {
    add this process to S.L;
    block();
  }
  ```

  V(S)

  ```
  S.value++;
  if(S.value<=0){
    remove a process P from S.L;
    wakeup(P);
  }
  ```

- Busy-wait vs Block/wakeup

  - 일반적으로는 Block/wakeup이 좋다.
  - 근데 Critical section의 길이가 너무 짧으면 Busy-wait가 효율적이다.
  - 왜냐하면 Bock/Wakeup은 오버헤드가 들기때문에

- counting semaphore
  - 도메인이 0 이상인 임의의 정수값
  - 주로 resource counting에 사용
- binary semaphore(mutex)

  - 0또는 1 값만 가질 수 있음
  - 주로 mutual exclusion(lock/unlock)에 사용

- Deadlock: 둘 이상의 프로세스가 서로 상대방에 의해 충족될 수 있는 event를 무한히 기다리는 현상
- indefinite blocking: 프로세스가 suspend된 이유에 해당하는 세마포어 큐에서 빠져나갈 수 없는 현상
